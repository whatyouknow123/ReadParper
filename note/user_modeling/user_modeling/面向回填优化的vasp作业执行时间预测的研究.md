# 题目

<p>面向回填优化的vasp作业执行时间预测的研究</p>

#作者

- 吴桂宝

# 发表于

- 中科大研究生毕业论文

# 摘要

1. 分析了vasp作业特性，通过解析日志与输入文件来抽取相应的作业特征集，基于这些特征集提出一种基于stacking模型的二次学习算法IRPA, 对vasp作业进行时长预测。该算法在多个子模型预测结果的基础上进行二次训练，结合各个子预测模型的优势，以此达到更高的预测准确性。
2. 提出基于径向基网络的预测算法BRBF，该算法主要是利用径向基网络对位置线性函数拟合的优越性

# 相关研究与技术

## 回填策略简介

### 基本概念
<p>回填算法，其允许为大作业预留资源，但是预约过程中产生的资源碎片可以被分配，就是说可以让等待队列中排在后面的小作业跳过预约资源的大作业先于该大作业被调度执行</p>

### 作用
<p>避免大作业长时间得不到调度而产生饥饿现象又可以让资源碎片得到充分作用，其能够很大程度上提高作业的平均响应时间，增加系统集群的吞吐量以及资源利用率。</p>

### 基本策略

- easy backfillng
	- 仅要求回填后的作业不会搁置等待队列中的第一个作业的执行就行， 而不去考虑其他排在该回填作业之前的等待队列中的作业
	![](pictures/easy_backfilling.png)
	- 集群的空闲cpu核数和系统剩余的cpu核数是不一样的，空闲的cpu核数是对应时刻集群真实的闲置的cpu核数，而剩余cpu核数是回填决策后资源时空图的剩余cpu核数，而此时回填作业可能还没有被调度。

	- <font color='red'>这种策略的缺点就是前瞻性不足。因为它只考虑回填作业是否延误等待队列中第一个作业的执行，而没有考虑它对后面作业的影响，这就很容易导致作业执行的不可预测性</font>
- conservative backfilling
	- 确保回填作业不会延迟所有在队列中排在去前面的作业的执行
	- 优点是如果能够准确知道运行时间就可以保证作业调度的公平性
	![](pictures/conservative_backfilling.png)

## 作业运行时间预测相关研究

### 知道执行程序

- CNN
- 程序静态分析

### 不知道执行程序的黑盒预测

- 基于基准程序的预测
- 基于作业内在特征的预测
- 基于作业历史的预测
	- 作业相互到达过程的相似性
	- 执行时间上表现出的阶梯式特性以及邻近相似性

# 数据预处理

### 高性能计算作业时长预测问题描述

1. 用户

	![](pictures/user_object.png)

2. 资源  

	![](pictures/resource_object.png)

3. 队列  

	![](pictures/queue_object.png)

4. 作业  

	![](pictures/job_object.png)

5. 输入输出
	
	![](pictures/inout_object.png) 

#### 资源

- 节点通信时间有一定占比
- 受到当前内存状况的影响【只用到了cpu核数这个特征】
- cpu资源利用率对作业执行时间的长短影响不大

#### 用户

- 相近的一段时间提交的作业执行时长比较相近
- 工作日提交的作业执行时长比较短
- 节假日提交的作业执行时长比较长
- 用户的研究领域比较专一

#### 队列

- 有优先级
- 作业提交的等待队列由用户自身选择

#### 输入

- 包括了模拟计算的类型、初始状态、收敛精度以及最大迭代次数阈值等和执行时长紧密相关的特征

#### 输出

- 这个特征没用

### 数据特征分析

- 不同用户或者不同队列中vasp作业的时长分布情况是比较类似，都近似于高斯分布
- 单纯从队列或者用户的不同对vasp作业的时长范围进行划分判定基本上不可行的

### 数据特征抽取

<p>作者任务作业泛属性与vasp作业时长分布关联性甚微，再者这些属性特征与作业的整个执行的过程也无任何关系，故而对于作业执行时间并没有直接影响，所以不考虑使用调度的泛属性来进行vasp作业的时长预测，只考虑与vasp作业执行息息相关的属于vasp作业特有的内部属性特征</p>

#### 数据解析

- 所提取的特征

	![](pictures/vasp_character.png)

- 数据规范化
	
	- 删除istart=1的数据
	- ispin进行了one-hot模型
	- exetime取以10为底的log值，作为目标值

# 针对vasp作业时长的两种预测方法

## 预测的评价标准

- 平均绝对误差，平均相对误差，平均绝对百分比误差，这三者效果很差
- 准确率和召回率

## 基于stack模型的作业时长预测算法

### 子模型简介

#### 随机森林回归

1. 最小化残差平方和来选择划分属性

#### 支持向量回归

1. 目标是使所有样本点到目标超平面距离的总偏差最小

#### 贝叶斯岭回归

1. 通过加入惩罚项结局解决模型复杂度问题

### IRPA预测算法

![](pictures/irpa_algorithm.png)


## 基于径向基神经网络的混合预测算法

- 径向基神经网络是通过径向基函数来做非线性变换，训练时利用样本内插值的方式来拟合任何未知的函数
![](pictures/rbf.png)

### BRBF预测算法

- rbf是局域插值来进行未知函数的拟合，他需要的输入是比较平滑和规范的，作者通过一个贝叶斯分类器，输出一个概率向量，将此概率向量作为rbf网络的输入
- 按照任务的运行时间长短分了57个类别
![](pictures/brbf_algorithm.png)


# 基于vasp执行时长预测的回填调度

- 采用了conservative backfilling回填算法
